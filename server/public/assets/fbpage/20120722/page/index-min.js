KISSY.add("utils/build-page",function(a){function c(){var c=b(".fb-build-page"),d=this;c.on("click",function(c){c.preventDefault();var e=b(c.target),f=e.siblings(".status"),g=e.siblings("input");f.html("building...");var h=g.val();a.ajax({url:e.attr("href"),data:{timestamp:h},dataType:"json",success:function(a){if(a.err){var b=a.err;f.html("Error:"+b.message);return}f.html("success!"),setTimeout(function(){f.html("")},2e3),a.reports&&d.fire("report",{reports:a.reports})}})})}var b=a.all;return a.extend(c,a.Base),new c}),KISSY.add("utils/calendar-init",function(a,b,c){var d=a.all;return{init:function(e){var f=new c.Popup({width:192});f.render();var g=(new b(f.get("contentEl"))).on("select",function(b){this.targetInput&&d(this.targetInput).val(a.Date.format(b.date,"yyyymmdd")),f.hide()});d(e.triggers).on("click",function(a){f.show();var b=d(a.target);f.align(b,["bl","tl"]),g.targetInput=b}),d("body").on("mousedown",function(a){f.get("contentEl").contains(a.target)||f.hide()})}}},{requires:["calendar","overlay","calendar/assets/base.css"]}),KISSY.add("page/mods/reporter",function(a,b,c,d,e){var f=a.all,g=function(a){var b=this;b.$el=f(a);if(!b.$el||!b.$el.length)throw new Error("container is not found")};return a.extend(g,a.Base,{addPluginReporter:function(){},addReport:function(b){var c=this;c.appendReportHTML(b);return;var d,e},appendReportHTML:function(a){var b=this;html=g.template_report.render({fb_report:b.plugins.fb.call(b,a.fb),fb_plugin:b.plugins.plugins.call(b,a.plugins)});var a=b.$el.all(".report");a.length>0?f(html).insertBefore(a[0]):f(html).appendTo(b.$el)},plugins:{fb:function(a){return g.template_fb.render(a)},plugins:function(b){console.log(b);var c=[];return a.each(b,function(a){c.push(g.template_plugin.render({text:JSON.stringify(a," ",2)}))}),c.join("")}}},{template_fb:b(c.html),template_plugin:b(e.html),template_report:b(d.html)}),g},{requires:["template","page/template/report-fb.tpl","page/template/report-wrap.tpl","page/template/report-plugin.tpl"]}),KISSY.add("page/template/report-fb.tpl",function(){return{html:"<div class=\"report-fb\">\n    <div class=\"row-fluid\">\n        <dl class='span4'>\n            <dt>\u7248\u672c</dt>\n            <dd>{{build_version}}</dd>\n        </dl>\n        <dl class='span4'>\n            <dt>\u6253\u5305\u65f6\u95f4\u6233</dt>\n            <dd>{{build_timestamp}}</dd>\n        </dl>\n        <dl class='span4'>\n            <dt>\u7528\u65f6</dt>\n            <dd>{{build_used_time}}ms</dd>\n        </dl>\n    </div>\n</div>"}}),KISSY.add("page/template/report-wrap.tpl",function(){return{html:'<div class="report">\n    <div class="report-hd">{{fb_report}}</div>\n    <div class="report-bd">{{content}}</div>\n</div>'}}),KISSY.add("page/template/report-plugin.tpl",function(){return{html:'<div class="report-plugin-item">\n    <pre>{{text}}</pre>\n</div>'}}),KISSY.add("page/index",function(a,b,c,d){var e=a.all;a.ready(function(){var a=new d("#reports");b.on("report",function(b){a.addReport(b.reports)}),c.init({triggers:"input.timestamp-input"})})},{requires:["utils/build-page","utils/calendar-init","./mods/reporter"]}); 