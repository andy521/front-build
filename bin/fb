#!/usr/bin/env node
var argv = require('optimist')
	.demand(1)
	.string('timestamp')
    .string('version')
    .string('_')
    .alias('t', 'timestamp')
    .alias('v', 'version')
    .alias('d', 'debug')
	.argv;

var cwd = process.cwd();

var commands = require('../lib/commands');

function done(err) {
	if(err) {
		if (argv.debug) {
			throw err;
		} else {
			if (typeof err === 'string') {
				console.log('Error: %s', err);
			} else if (err.message) {
				console.log('Error: %s', err.message);
			}
			console.log('fail');
		}
		process.exit(1);
	}
	console.log('success!');
	process.exit(0);
}




switch(argv._[0]) {
	case 'init':
		command = 'init';
		break;

	case 'a':
	case 'add':
	case 'addpage':
		command = 'addpage';
		break;

	case 'v':
	case 'ver':
	case 'version':
		command = 'version';
		break;

	case 'b':
	case 'build':
		command = 'build';
		break;
};

if (commands && commands[command]) {
	commands[command]({
		argv: argv,
		cwd: cwd
	}, done);
}


